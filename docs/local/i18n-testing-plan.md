# 다국어 지원 테스트 계획서

## 프로젝트 개요
- **프로젝트**: 만다라트 애플리케이션 다국어 지원
- **기술 스택**: Next.js 14, next-intl, TypeScript
- **지원 언어**: 한국어(ko), 영어(en), 일본어(ja)
- **작성일**: 2025-01-16

## 현재 상태 분석

### 기존 구현 현황
- ✅ next-intl 라이브러리 설정 완료
- ✅ YAML 기반 번역 파일 구조 (`ko.yaml`, `en.yaml`, `ja.yaml`)
- ✅ URL 기반 라우팅 (`/ko/`, `/en/`, `/ja/`)
- ✅ 서버 사이드 렌더링 지원
- ✅ 언어별 폰트 최적화

### 현재 설정 특징
```typescript
// src/i18n/routing.ts
export const routing = defineRouting({
  locales: ['ko', 'en', 'ja'],
  defaultLocale: 'ko',
  localeDetection: false,  // 🚨 자동 언어 감지 비활성화
  localePrefix: 'always'   // 모든 경로에 언어 코드 표시
});
```

### 문제점 식별
1. **IP 기반 언어 감지 없음**: 해외 접속 시 자동 언어 설정 불가
2. **브라우저 언어 무시**: Accept-Language 헤더 감지 비활성화
3. **사용자 경험 저하**: 해외 사용자가 수동으로 언어 변경 필요

## 개선 목표

### 1단계: 현재 상태 검증
- [ ] 기존 다국어 기능 완전성 테스트
- [ ] 번역 파일 누락 항목 확인
- [ ] 라우팅 동작 검증

### 2단계: IP 기반 언어 감지 구현
- [ ] 미들웨어 수정으로 지역 감지 로직 추가
- [ ] 국가별 언어 매핑 테이블 구성
- [ ] 폴백 전략 수립

### 3단계: 브라우저 언어 감지 활성화
- [ ] Accept-Language 헤더 처리
- [ ] 사용자 선택 언어 쿠키 저장
- [ ] 우선순위 정책 수립

### 4단계: 사용자 경험 개선
- [ ] 언어 전환 UI 개선
- [ ] 자동 리다이렉트 안내 메시지
- [ ] 언어 선택 기억 기능

## 테스트 전략

### 로컬 환경 테스트
1. **브라우저 개발자 도구 활용**
   - Accept-Language 헤더 변경
   - 쿠키 조작 테스트
   - 네트워크 조건 시뮬레이션

2. **curl 명령어 테스트**
   ```bash
   # 영어 브라우저 시뮬레이션
   curl -H "Accept-Language: en-US,en;q=0.9" http://localhost:3000
   
   # 일본어 브라우저 시뮬레이션
   curl -H "Accept-Language: ja-JP,ja;q=0.9" http://localhost:3000
   ```

### VPN 환경 테스트
1. **테스트 대상 국가**
   - 🇯🇵 일본: 일본어 자동 감지 확인
   - 🇺🇸 미국: 영어 자동 감지 확인
   - 🇬🇧 영국: 영어 자동 감지 확인

2. **VPN 도구 추천**
   - **VPN Gate** (무료, 쓰쿠바대학): https://www.vpngate.net/en/
   - **ProtonVPN** 무료 플랜
   - **Windscribe** 무료 플랜

### 배포 환경 테스트
1. **Vercel 배포 시 지역 감지**
   - `request.geo` 객체 활용
   - 실제 IP 기반 언어 감지 검증

2. **자동화 테스트**
   - Playwright를 활용한 지역별 테스트
   - CI/CD 파이프라인 통합

## 위험 요소 및 대응 방안

### 기술적 위험
1. **성능 저하**: 미들웨어 로직 추가로 인한 응답 시간 증가
   - **대응**: 캐싱 전략 수립, 경량화된 지역 감지 로직

2. **SEO 영향**: 자동 리다이렉트로 인한 검색 엔진 최적화 문제
   - **대응**: 정적 언어 링크 제공, 메타 태그 최적화

3. **하이드레이션 불일치**: 서버-클라이언트 간 언어 설정 차이
   - **대응**: 클라이언트 사이드 검증 로직 추가

### 사용자 경험 위험
1. **잘못된 언어 감지**: IP 기반 감지의 부정확성
   - **대응**: 사용자 언어 선택 UI 제공, 쿠키 기반 기억 기능

2. **접근성 문제**: 언어 변경 기능의 접근성 부족
   - **대응**: 키보드 네비게이션, 스크린 리더 지원

## 성공 지표

### 정량적 지표
- [ ] 해외 사용자 이탈률 10% 감소
- [ ] 언어 변경 클릭률 50% 감소 (자동 감지로 인한)
- [ ] 페이지 로드 시간 영향 < 100ms

### 정성적 지표
- [ ] 해외 사용자 피드백 개선
- [ ] 언어 설정 관련 문의 감소
- [ ] 전반적인 사용자 만족도 향상

## 일정 계획

### 1주차: 분석 및 설계
- 현재 상태 완전 분석
- 기술 스펙 문서 작성
- 구현 방향 확정

### 2주차: 구현
- 미들웨어 수정
- 언어 감지 로직 구현
- 테스트 코드 작성

### 3주차: 테스트
- 로컬 환경 테스트
- VPN 환경 테스트
- 성능 테스트

### 4주차: 배포 및 모니터링
- 스테이징 환경 배포
- 프로덕션 배포
- 모니터링 및 피드백 수집

## 다음 단계
1. **IP 기반 언어 감지 구현 상세 계획** 수립
2. **테스트 시나리오** 구체화
3. **성능 최적화 전략** 수립
4. **사용자 피드백 수집 방안** 마련