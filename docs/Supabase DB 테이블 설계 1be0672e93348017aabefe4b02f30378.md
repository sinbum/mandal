# Supabase DB í…Œì´ë¸” ì„¤ê³„

## ğŸ§¾ Supabase DB í…Œì´ë¸” ì„¤ê³„

### 1. ğŸ§‘â€ğŸ’¼ `users` (Supabase ê¸°ë³¸ ì œê³µ)

> Supabaseì˜ ì¸ì¦ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë©´ ìë™ ìƒì„±ë©ë‹ˆë‹¤.
> 

```sql

-- Supabase ì¸ì¦ ì‹œìŠ¤í…œì„ í†µí•´ ê´€ë¦¬
id UUID PRIMARY KEY
email TEXT
created_at TIMESTAMP

```

---

### 2. ğŸ“‹ `mandalarts` â€” ë§Œë‹¤ë¼íŠ¸ ì „ì²´ ë¬¸ì„œ

```sql

CREATE TABLE mandalarts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  title TEXT NOT NULL,
  is_template BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

```

ğŸ”¹ **ì¸ë±ìŠ¤ ì¶”ì²œ**

```sql

CREATE INDEX idx_user_id ON mandalarts(user_id);

```

---

### 3. ğŸŸ¦ `mandalart_cells` â€” 81ì¹¸ ê°ê°ì˜ ì…€ ë°ì´í„°

```sql

CREATE TABLE mandalart_cells (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  mandalart_id UUID REFERENCES mandalarts(id) ON DELETE CASCADE,
  position INT NOT NULL CHECK (position >= 0 AND position < 81),
  topic TEXT,               -- 10ì ì´ë‚´ ì œí•œì€ í”„ë¡ íŠ¸/ë¡œì§ì—ì„œ ì²˜ë¦¬
  memo TEXT,
  image_url TEXT,
  color TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

```

ğŸ”¹ **ì¤‘ë³µ ë°©ì§€ ì œì•½**

```sql

-- í•˜ë‚˜ì˜ ë§Œë‹¤ë¼íŠ¸ ì•ˆì—ì„œ position ì¤‘ë³µ ë°©ì§€
CREATE UNIQUE INDEX idx_mandalart_cell_unique ON mandalart_cells(mandalart_id, position);

```

---

### 4. ğŸ“¦ (ì„ íƒ) `templates` â€” í…œí”Œë¦¿ ì •ë³´ ê´€ë¦¬ (is_templateê³¼ ë³„ë„ ê´€ë¦¬ ì‹œ)

> ë§Œë‹¤ë¼íŠ¸ë¥¼ ê·¸ëŒ€ë¡œ ë³µì œí•´ ìƒì„±í•˜ëŠ” êµ¬ì¡°ë¼ë©´ ë³„ë„ í…Œì´ë¸” ì—†ì´ mandalarts.is_template = TRUEë¡œ êµ¬ë¶„í•´ë„ ì¶©ë¶„í•©ë‹ˆë‹¤.
> 
> 
> í•˜ì§€ë§Œ ë‹¤ì–‘í•œ ë©”íƒ€ë°ì´í„°(ì¹´í…Œê³ ë¦¬, íƒœê·¸, ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ ë“±)ë¥¼ ë¶™ì¼ ê³„íšì´ë¼ë©´ ì•„ë˜ì²˜ëŸ¼ ë³„ë„ `templates` í…Œì´ë¸” ì‚¬ìš© ê°€ëŠ¥.
> 

```sql

CREATE TABLE templates (
  id UUID PRIMARY KEY,
  mandalart_id UUID REFERENCES mandalarts(id) ON DELETE CASCADE,
  title TEXT NOT NULL,
  preview_image_url TEXT,
  category TEXT,  -- ex: "ìê¸°ê³„ë°œ", "í•™ì—…"
  created_at TIMESTAMP DEFAULT NOW()
);

```

---

## ğŸ§  ë°ì´í„° ê´€ê³„ë„

```

users
  â””â”€â”€ mandalarts
          â””â”€â”€ mandalart_cells (81ê°œ)

```

---

## âœ… ë°ì´í„° ì €ì¥ íë¦„ ì˜ˆì‹œ (ìƒˆ ë§Œë‹¤ë¼íŠ¸ ë§Œë“¤ê¸°)

1. `mandalarts` í…Œì´ë¸”ì— ìƒˆ ë¬¸ì„œ 1ê±´ ì‚½ì… â†’ ìƒì„±ëœ `id` ë°˜í™˜
2. `mandalart_cells`ì— `position` 0~80ë²ˆê¹Œì§€ ë¹ˆ ë°ì´í„° ì‚½ì… (ë˜ëŠ” í…œí”Œë¦¿ ê¸°ë°˜ ë‚´ìš© ì‚½ì…)
3. ì´í›„ ê° ì¹¸ í´ë¦­ ì‹œ ê°œë³„ ì—…ë°ì´íŠ¸

---

## ğŸ“Œ ë³´ì•ˆ ì •ì±… (Row-Level Security)

Supabaseì—ì„œëŠ” ì•„ë˜ RLS ì •ì±… ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤:

### `mandalarts` RLS ì˜ˆì‹œ:

```sql

-- ì‚¬ìš©ìëŠ” ë³¸ì¸ì˜ ë¬¸ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥
CREATE POLICY "Allow user access to own mandalarts"
  ON mandalarts
  FOR ALL
  USING (user_id = auth.uid());

```

### `mandalart_cells` RLS ì˜ˆì‹œ:

```sql

-- ì‚¬ìš©ìëŠ” ìì‹ ì˜ ë§Œë‹¤ë¼íŠ¸ì— ì†í•œ ì…€ë§Œ ì ‘ê·¼ ê°€ëŠ¥
CREATE POLICY "Allow user access to own cells"
  ON mandalart_cells
  FOR ALL
  USING (
    mandalart_id IN (
      SELECT id FROM mandalarts WHERE user_id = auth.uid()
    )
  );

```